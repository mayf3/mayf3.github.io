<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>简介knn算法 - My Home</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="mayf3" />
  <meta name="description" content="什么是knn knn是Cover和Hart在1968年的论文里提出的分类算法，全名叫K Nearest Neighbor，中文翻译是k近邻算法。 knn的思想很" />

  <meta name="keywords" content="Hugo, theme, jane" />






<meta name="generator" content="Hugo 0.79.1" />


<link rel="canonical" href="http://mayf3.github.io/post/knn/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="简介knn算法" />
<meta property="og:description" content="什么是knn knn是Cover和Hart在1968年的论文里提出的分类算法，全名叫K Nearest Neighbor，中文翻译是k近邻算法。 knn的思想很" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://mayf3.github.io/post/knn/" />
<meta property="article:published_time" content="2020-10-25T09:28:00+08:00" />
<meta property="article:modified_time" content="2020-10-26T21:38:00+08:00" />
<meta itemprop="name" content="简介knn算法">
<meta itemprop="description" content="什么是knn knn是Cover和Hart在1968年的论文里提出的分类算法，全名叫K Nearest Neighbor，中文翻译是k近邻算法。 knn的思想很">
<meta itemprop="datePublished" content="2020-10-25T09:28:00+08:00" />
<meta itemprop="dateModified" content="2020-10-26T21:38:00+08:00" />
<meta itemprop="wordCount" content="2146">



<meta itemprop="keywords" content="machine-learning,knn," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="简介knn算法"/>
<meta name="twitter:description" content="什么是knn knn是Cover和Hart在1968年的论文里提出的分类算法，全名叫K Nearest Neighbor，中文翻译是k近邻算法。 knn的思想很"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">My Home</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mayf3.github.io/">This is Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://mayf3.github.io/post/">Archives</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      My Home
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mayf3.github.io/">This is Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://mayf3.github.io/post/">Archives</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">简介knn算法</h1>
      
      <div class="post-meta">
        <time datetime="2020-10-25" class="post-time">
          2020-10-25
        </time>
        <div class="post-category">
            <a href="http://mayf3.github.io/categories/machine-learning/"> machine-learning </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是knn">什么是knn</a></li>
    <li><a href="#knn有哪些参数">knn有哪些参数</a>
      <ul>
        <li><a href="#k值的选择">k值的选择</a></li>
        <li><a href="#距离度量">距离度量</a></li>
        <li><a href="#分类决策规则">分类决策规则</a></li>
      </ul>
    </li>
    <li><a href="#knn有哪些实现">knn有哪些实现</a></li>
    <li><a href="#knn的优缺点">knn的优缺点</a></li>
    <li><a href="#knn的实际应用">knn的实际应用</a></li>
    <li><a href="#knn的常见问题">knn的常见问题</a>
      <ul>
        <li><a href="#归一化">归一化</a></li>
      </ul>
    </li>
    <li><a href="#参考资料">参考资料</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="什么是knn">什么是knn</h2>
<p>knn是Cover和Hart在1968年的<a href="https://pdfs.semanticscholar.org/a3c7/50febe8e72a1e377fbae1a723768b233e9e9.pdf?_ga=2.260660749.1635069309.1608960216-652721388.1605965658">论文</a>里提出的分类算法，全名叫K Nearest Neighbor，中文翻译是k近邻算法。<br>
knn的思想很简单，核心假设是同类别的样本在特征空间上的距离较近，但由于数据存在噪声，只找最近的样本会有问题，所以我们综合考虑最近的k个样本。<br>
基于这个思想，knn对每一个样本，会在训练集中找出与该样本距离最接近的k个样本，取这k个样本中出现次数最多的类别作为该样本的分类结果。</p>
<p>用下面的例子来简单介绍一下knn，假设有10个训练数据，如下图，蓝三角形和绿圆形分别表示不同的类别：
<img src="/knn/DEBCF616-2EB5-42C7-9CA2-0B7C2F1BC9F5.png" alt="c44f2e1029eaa562953dbbd709b5846b">
若我们想得到下图红点的类别，假定k为3，则我们在训练样本中找最近的3个样本，即红色圆圈内有的两个蓝三角形和一个绿圆形，于是我们将红点分类为多数类，即蓝三角。
<img src="/knn/B4D9B651-D5A7-4A37-87A6-0AF9614DED62.png" alt="c9d5a145e64e0655c315dff4cc5661a4"></p>
<h2 id="knn有哪些参数">knn有哪些参数</h2>
<p>knn的模型主要由下面三个要素决定：</p>
<ol>
<li>k值的选择（例子中的k=3）</li>
<li>距离度量（例子中使用了欧式距离，所示的红色圆圈）</li>
<li>分类决策规则（例子中以多数类别作为分类结果）</li>
</ol>
<h3 id="k值的选择">k值的选择</h3>
<p>k值的选择需要结合具体的应用数据，通常会选用较小的一个值，然后通过交叉验证法来选取最优的k值。</p>
<p>可以从方差和偏差来考虑k值对模型的影响：<strong>随着k值的增大，模型的方差会逐渐变小，偏差逐渐变大。</strong></p>
<blockquote>
<p>假定k值为1，算法就退化成最近邻，此时模型对数据非常敏感，一旦数据噪声较多，则模型的准确率会很低。<br>
随着k值的增大，模型逐渐降低了数据噪声的干扰，但分类的结果会逐渐倾向于整体数据。<br>
当k值为N时，则将永远返回数据中占比最多的分类，此时方差为0。</p>
</blockquote>
<p>这里有一篇<a href="http://scott.fortmann-roe.com/docs/BiasVariance.html">文章</a>，以knn为例讲解了偏差和方差的区别，可以看看。</p>
<h3 id="距离度量">距离度量</h3>
<p>在数学上有对于距离度量的严谨定义，这里就不详细说了。<br>
常见的距离度量，主要是曼哈顿距离、欧式距离（knn最常用的距离）和切比雪夫距离。<br>
对于维度为N的x和y向量，各个距离的公式如下:</p>
<p>曼哈顿距离
$$
L_1 = \sum_{i=1}^N|X_i - Y_i|
$$</p>
<p>欧式距离
$$
L_2 = \Bigg(\sum_{i=1}^N{(X_i - Y_i)^{2}}\Biggr)^{\tfrac{1}{2}}
$$</p>
<p>切比雪夫距离
$$
L_\infty = \max_i|X_i - Y_i|
$$</p>
<h3 id="分类决策规则">分类决策规则</h3>
<p>knn的分类决策规则往往是多数表决，由距离最近的k个样本的多数类决定测试样本的类别。多数表决规则其实等价于经验风险最小化。<br>
其实还有其他方案，比如将这k个样本按照距离进行加权平均（该规则也能用来回归）等等。</p>
<h2 id="knn有哪些实现">knn有哪些实现</h2>
<p>knn算法的难点是如何快速在训练集里找到距离前k小的样本，最简单的实现是线性扫描，对于测试样本，计算该样本到所有训练样本的距离，排序取前k个。<br>
另外一种常见的实现方法是采用kd树，这里就不展开介绍了，在数据随机且维度不大的情况下，kd树的复杂度会优于线性扫描，但如果维度接近于样本数量，则kd树约等于线性扫描。</p>
<h2 id="knn的优缺点">knn的优缺点</h2>
<p>k近邻算法的优点如下：</p>
<ol>
<li>实现简单</li>
<li>没有显式的训练过程</li>
<li>精度高（根据knn的论文，knn的泛化错误率不超过贝叶斯最优分类器的错误率的两倍）</li>
<li>具有可解释性</li>
<li>对异常值不敏感</li>
<li>无数据输入假定</li>
</ol>
<p>k近邻算法的缺点如下：</p>
<ol>
<li>计算复杂度高</li>
<li>空间复杂度高</li>
</ol>
<h2 id="knn的实际应用">knn的实际应用</h2>
<p>我在<a href="https://github.com/mayf3/machine_learning/tree/master/algorithm/knn">gihtub仓库</a>里实现了knn的线性扫描版本和kd树版本，拿mnist和鸢尾花卉数据集来评估knn的性能。<br>
结果发现knn的算法虽然简单，但效果确实还挺好，mnist的准确率有94%以上，鸢尾花卉的准确率也有93%(42/45)。<br>
此外我也在鸢尾花卉数据集上尝试对特征进行归一化，用min-max归一化算法后准确率达到95%(43/45)，用z-score归一化后准确率达到98%(44/45)。</p>
<p>但knn有一个显著的问题，就是运行效率低，特别是在mnist数据集上，1w的测试数据，6w的训练数据，特征数量有28^2=784个。<br>
如果用线性扫描法，则总的运算量达到1w * 6w * 784，假设计算机每秒运算量为10^8，也需要4707秒，超过一个小时。<br>
尝试用kd树来优化knn，结果其性能反而比线性扫描还差。</p>
<p>如果想针对knn的效率问题进行优化，之后可以尝试一下非精确的knn算法，或则是对数据进行降维。</p>
<h2 id="knn的常见问题">knn的常见问题</h2>
<h3 id="归一化">归一化</h3>
<p>knn使用的是欧式距离，欧式距离对数据的尺度很敏感，比如下面的例子：</p>
<blockquote>
<p>假定身高的单位为米，体重的单位为克，很明显这两者在尺度上就有巨大的差异。<br>
此时一个1.7m，60kg的样本和1.0m，60kg的样本的距离为0.7，而1.7m，60kg的样本和1.7m，59kg的样本的距离却高达1000。<br>
若我们是在做大人或小孩的分类，则这样的距离计算会很影响knn的性能。</p>
</blockquote>
<p>在大多数情况下，我们都不希望由于特征的尺度不同，而导致其对距离的贡献不一，比如上面例子中，身高的特征即使差异很大，也几乎不影响距离的计算。
为了解决这种问题，我们在使用knn的时候（或则其他和距离尺度相关的算法），我们常常会使用下面的归一化方法来处理数据。</p>
<p>min-max归一化，需要对每一个特征计算min和max。
$$
m = \frac{(x - x_{min})}{(x_{max} - x_{min})}
$$</p>
<p>z-score归一化，需要对每一个特征计算均值和标准差。
$$
z = (x - \mu) / \sigma
$$</p>
<p>当我在尝试knn算法的时候，也很好奇这两种归一化算法的优劣，然后就搜到了这篇<a href="http://j.mecs-press.net/ijcnis/ijcnis-v9-n11/IJCNIS-V9-N11-4.pdf">论文</a>。<br>
从论文里给出的对比效果来看，似乎min-max的要比z-score略好一点：
<img src="/knn/B4491EA5-817E-4F13-8994-50BE70C206D2.png" alt="427ee4485988d610a448fa4f96101bfd"></p>
<h2 id="参考资料">参考资料</h2>
<p>机器学习实战 第二章 k-近邻算法<br>
机器学习 第十章 降维与度量学习<br>
统计学习方法 第三章 k近邻法<br>
特征工程入门与实践 第三章 特征增强：清洗数据 - 3.3 标准化和归一化<br>
<a href="https://pdfs.semanticscholar.org/a3c7/50febe8e72a1e377fbae1a723768b233e9e9.pdf?_ga=2.260660749.1635069309.1608960216-652721388.1605965658">Nearest Neighbor Pattern Classification</a>
<a href="http://scott.fortmann-roe.com/docs/BiasVariance.html">Understanding the Bias-Variance Tradeoff</a>
<a href="http://j.mecs-press.net/ijcnis/ijcnis-v9-n11/IJCNIS-V9-N11-4.pdf">Comparative Analysis of KNN Algorithm using Various Normalization Techniques</a></p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">mayf3</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2020-10-26
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a href="https://github.com/mayf3/blog" rel="noopener" target="_blank">See origin</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://mayf3.github.io/tags/machine-learning/">machine-learning</a>
          <a href="http://mayf3.github.io/tags/knn/">knn</a>
          
        </div>

      
      <nav class="post-nav">
        
        
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:daretobeyourself.m.y.f@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>


<a href="http://mayf3.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        mayf3
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css"
    integrity="sha384-BdGj8xC2eZkQaxoQ8nSLefg4AV4/AwB3Fj+8SUSo7pnKP6Eoy18liIKTPn9oBYNG"
    crossorigin="anonymous">

  
  <script defer
    src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.js"
    integrity="sha384-JiKN5O8x9Hhs/UE5cT5AAJqieYlOZbGT3CHws/y97o3ty4R7/O5poG9F3JoiOYw1"
    crossorigin="anonymous"></script>

  
  <script defer
    src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/contrib/auto-render.min.js"
    integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI"
    crossorigin="anonymous" onload="renderMathInElement(document.body);">
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      renderMathInElement(document.body, {
        
      });
    });
  </script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
